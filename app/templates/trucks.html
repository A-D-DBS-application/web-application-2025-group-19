{% extends 'base.html' %}
{% block title %}Trucks — Delivery Schedule{% endblock %}

{% block content %}
<div class="page-header">
  <h1 class="page-title">Trucks</h1>
  <p class="page-subtitle">Beheer en registreer voertuigen in je wagenpark.</p>
</div>

<!-- Voertuig Registreren -->
<div class="card mb-5">
  <div class="card-header">
    <h2 class="font-semibold flex items-center gap-2">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
      </svg>
      Voertuig Registreren
    </h2>
  </div>
  <div class="card-body">
    <form method="POST" action="{{ url_for('main.add_truck') }}">
      <div class="grid grid-cols-2 gap-4">
        <div class="form-group">
          <label class="form-label">Naam (Merk & Model)</label>
          <input type="text" name="name" placeholder="Mercedes Sprinter" class="form-input" required>
        </div>
        <div class="form-group">
          <label class="form-label">Kleur</label>
          <input type="text" name="color" placeholder="Wit" class="form-input">
        </div>
        <div class="form-group">
          <label class="form-label">Type voertuig</label>
          <select name="truck_type" class="form-select">
            <option value="">Kies type voertuig...</option>
            {% for t in truck_types %}
              <option value="{{ t.value }}">{{ t.label }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Capaciteit: M.T.M. in kg</label>
          <input type="text" name="capacity" placeholder="1500 kg" class="form-input">
        </div>
        <div class="form-group">
          <label class="form-label">Nummerplaat</label>
          <input type="text" name="license_plate" placeholder="1-ABC-123" class="form-input">
        </div>
        <div class="form-group">
          <label class="form-label">Aankoopdatum</label>
          <input type="date" name="purchase_date" class="form-input">
        </div>
      </div>
      <div class="mt-4">
        <button type="submit" class="btn btn-primary">Voertuig toevoegen</button>
      </div>
    </form>
  </div>
</div>

<div class="divider"></div>

<!-- Overzicht Wagenpark -->
<div class="table-container">
  <div class="card-header flex justify-between items-center">
    <div>
      <h2 class="font-semibold flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75h.007v.008H3.75V6.75zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zM3.75 12h.007v.008H3.75V12zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm-.375 5.25h.007v.008H3.75v-.008zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
        </svg>
        Overzicht Wagenpark
      </h2>
    </div>
  </div>

  {% if trucks %}
    <table class="table">
      <thead>
        <tr>
          <th>Naam</th>
          <th>Type</th>
          <th>Nummerplaat</th>
          <th>Capaciteit</th>
          <th>Aankoopdatum</th>
          <th class="text-center actions-col"></th>
        </tr>
      </thead>
      <tbody>
        {% for truck in trucks %}
          <tr>
            <td>
              <div class="flex items-center gap-2">
                {% if truck.color and truck.color != '-' %}
                  <span style="width: 12px; height: 12px; border-radius: 50%; background: {{ truck.color.lower() }}; border: 1px solid rgba(0,0,0,0.1);"></span>
                {% endif %}
                <span class="font-medium">{{ truck.name }}</span>
              </div>
            </td>
            <td>
              <span class="badge badge-default">{{ truck.truck_type }}</span>
            </td>
            <td>
              {% if truck.license_plate and truck.license_plate != '-' %}
                <code style="font-family: monospace; background: rgba(0,0,0,0.04); padding: 2px 6px; border-radius: 4px;">{{ truck.license_plate }}</code>
              {% else %}
                <span class="text-muted">—</span>
              {% endif %}
            </td>
            <td>{{ truck.capacity }}</td>
            <td>
              {% if truck.purchase_date %}
                {{ truck.purchase_date.strftime('%d-%m-%Y') }}
              {% else %}
                <span class="text-muted">—</span>
              {% endif %}
            </td>
            <td class="text-center">
              <form method="POST" action="{{ url_for('main.delete_truck', truck_id=truck.truck_id) }}" style="display: inline;" onsubmit="return confirm('Weet je zeker dat je dit voertuig wilt verwijderen?');">
                <button type="submit" class="btn btn-danger btn-sm">Verwijderen</button>
              </form>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <!-- Mobile card view -->
    <div class="table-mobile-view" style="display: none;">
      {% for truck in trucks %}
        <div class="table-mobile-card">
          <div class="table-mobile-row">
            <div class="table-mobile-label">Naam</div>
            <div class="table-mobile-value font-medium">{{ truck.name }}</div>
          </div>
          <div class="table-mobile-row">
            <div class="table-mobile-label">Type</div>
            <div class="table-mobile-value">
              <span class="badge badge-default">{{ truck.truck_type }}</span>
            </div>
          </div>
          <div class="table-mobile-row">
            <div class="table-mobile-label">Nummerplaat</div>
            <div class="table-mobile-value">
              {% if truck.license_plate and truck.license_plate != '-' %}
                <code style="font-family: monospace; background: rgba(0,0,0,0.04); padding: 2px 6px; border-radius: 4px;">{{ truck.license_plate }}</code>
              {% else %}
                <span class="text-muted">—</span>
              {% endif %}
            </div>
          </div>
          <div class="table-mobile-row">
            <div class="table-mobile-label">Capaciteit</div>
            <div class="table-mobile-value">{{ truck.capacity or '—' }}</div>
          </div>
          <div class="table-mobile-row">
            <div class="table-mobile-label">Aankoopdatum</div>
            <div class="table-mobile-value">
              {% if truck.purchase_date %}
                {{ truck.purchase_date.strftime('%d-%m-%Y') }}
              {% else %}
                <span class="text-muted">—</span>
              {% endif %}
            </div>
          </div>
          <div class="table-mobile-row delete-row">
            <form method="POST" action="{{ url_for('main.delete_truck', truck_id=truck.truck_id) }}" onsubmit="return confirm('Weet je zeker dat je dit voertuig wilt verwijderen?');">
              <button type="submit" class="btn btn-danger mobile-delete-btn">Verwijderen</button>
            </form>
          </div>
        </div>
      {% endfor %}
    </div>
    <div class="card-footer">
      <p class="text-small text-muted">Totaal: <strong>{{ trucks | length }}</strong> voertuig{% if trucks | length != 1 %}en{% endif %}</p>
    </div>
  {% else %}
    <div class="empty-state">
      <svg class="empty-state-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
        <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 18.75a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h6m-9 0H3.375a1.125 1.125 0 01-1.125-1.125V14.25m17.25 4.5a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h1.125c.621 0 1.129-.504 1.09-1.124a17.902 17.902 0 00-3.213-9.193 2.056 2.056 0 00-1.58-.86H14.25M16.5 18.75h-2.25m0-11.177v-.958c0-.568-.422-1.048-.987-1.106a48.554 48.554 0 00-10.026 0 1.106 1.106 0 00-.987 1.106v7.635m12-6.677v6.677m0 4.5v-4.5m0 0h-12" />
      </svg>
      <p class="empty-state-title">Er zijn nog geen voertuigen geregistreerd.</p>
      <p class="empty-state-text">Voeg een voertuig toe via het formulier hierboven.</p>
    </div>
  {% endif %}
</div>

<script>
  // Force mobile card view on small screens (match chauffeurs/leveringen gedrag)
  if (window.innerWidth <= 768) {
    const tableContainers = document.querySelectorAll('.table-container');
    tableContainers.forEach(container => {
      const table = container.querySelector('.table');
      const mobileView = container.querySelector('.table-mobile-view');
      if (table && mobileView) {
        table.style.display = 'none';
        mobileView.style.display = 'block';
      }
    });
  }
</script>
{% endblock %}
